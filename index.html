<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="shortcut icon"
      href="images/GenshinIcon.png"
      type="image/x-icon"
    />
    <title>张沐晨是去漫展去的！！！</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main>
      <h1>观看去漫展去的的兽装视频</h1>
      <nav>
        <ul>
          <li>
            <a href="videos/1.mp4" download
              ><i class="fas fa-video"></i> lsp你听我说</a
            >
          </li>
          <li>
            <a href="videos/2.mp4" download
              ><i class="fas fa-video"></i> 大半夜画的jb福瑞</a
            >
          </li>
          <li>
            <a href="videos/3.mp4" download
              ><i class="fas fa-video"></i> show his 兽装</a
            >
          </li>
          <li>
            <a href="videos/4.mp4" download
              ><i class="fas fa-video"></i> 热死力</a
            >
          </li>
          <li>
            <a href="videos/5.mp4" download
              ><i class="fas fa-video"></i> 重磅！跳舞视频！！！</a
            >
          </li>
        </ul>
      </nav>
      <section id="comments">
        <h2>评论区域</h2>
        <form id="comment-form">
          <label for="comment">评论:</label>
          <textarea id="comment" name="comment" required></textarea>
          <button type="submit">提交评论</button>
        </form>
        <div id="comment-section">
          <!-- 评论将被动态添加到这里 -->
        </div>
        <p id="comment-limit-message"></p>
      </section>
    </main>

    <script>
      // JavaScript代码
      window.onload = function () {
        getIPAddress();
        loadComments();
      };

      function getIPAddress() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "https://api.ipify.org?format=json", true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            localStorage.setItem("ipAddress", response.ip);
          }
        };
        xhr.send();
      }

      function canComment() {
        var oneHourInMilliseconds = 60 * 60 * 1000;
        var lastCommentTime = localStorage.getItem("commentLastTime");
        var currentTime = new Date().getTime();
        if (
          lastCommentTime &&
          currentTime - lastCommentTime < oneHourInMilliseconds
        ) {
          document.getElementById("comment-limit-message").textContent =
            "每小时只能评论一次，请一小时后再试。";
          return false;
        }
        localStorage.setItem("commentLastTime", currentTime);
        return true;
      }

      document
        .getElementById("comment-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          if (canComment()) {
            var comment = document.getElementById("comment").value;
            saveComment(comment);
            displayComment(comment, localStorage.getItem("ipAddress"));
            document.getElementById("comment").value = ""; // 清空输入框
          }
        });

      function saveComment(comment) {
        var comments = JSON.parse(localStorage.getItem("comments")) || [];
        var currentTime = new Date().toLocaleString(); // 获取当前时间
        comments.push({ text: comment, time: currentTime }); // 保存评论和时间
        localStorage.setItem("comments", JSON.stringify(comments));
      }

      function loadComments() {
        var comments = JSON.parse(localStorage.getItem("comments")) || [];
        comments.forEach((comment) => {
          displayComment(comment.text, comment.time);
        });
      }

      function displayComment(comment, ipAddress) {
        var commentElement = document.createElement("div");
        commentElement.innerHTML = `
    <strong class="comment-time">${ipAddress} - ${new Date(
          comment.time
        ).toLocaleString()}</strong><br>
    ${comment.text}  `;
        document.getElementById("comment-section").appendChild(commentElement);
      }
    </script>
  </body>
</html>