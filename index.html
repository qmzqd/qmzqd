<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>张沐晨是去漫展去的！！！</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <main>
        <h1>观看去漫展去的的兽装视频</h1>
        <nav>
            <ul>
                <li><a href="videos/1.mp4" download><i class="fas fa-video"></i> lsp你听我说</a></li>
                <li><a href="videos/2.mp4" download><i class="fas fa-video"></i> 大半夜画的jb福瑞</a></li>
                <li><a href="videos/3.mp4" download><i class="fas fa-video"></i> show his 兽装</a></li>
                <li><a href="videos/4.mp4" download><i class="fas fa-video"></i> 热死力</a></li>
                <li><a href="videos/5.mp4" download><i class="fas fa-video"></i> 重磅！跳舞视频！！！</a></li>
            </ul>
        </nav>
        <section id="comments">
            <h2>评论区域</h2>
            <form id="comment-form">
                <label for="comment">评论:</label>
                <textarea id="comment" name="comment" required></textarea>
                <button type="submit">提交评论</button>
            </form>
            <div id="comment-section"></div>
            <p id="comment-limit-message"></p> <!-- 用于显示评论限制信息 -->
        </section>
    </main>
    
    <script>
        // 获取IP地址
        function getIPAddress() {
            var xhr = new XMLHttpRequest(); // 修复了XMLHttpRequest的实例化
            xhr.open('GET', 'https://api.ipify.org?format=json', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    var ipAddress = response.ip;
                    // 存储IP地址到localStorage以便后续使用
                    localStorage.setItem('ipAddress', ipAddress); // 修正了键名
                }
            };
            xhr.send();
        }

        // 页面加载时获取IP地址
        window.onload = getIPAddress;

        // 修复每小时只能评论一次的功能问题
        function canComment() {
            var oneHourInMilliseconds = 60 * 60 * 1000;
            var lastCommentTime = localStorage.getItem('commentLastTime'); // 修正了键名
            var currentTime = new Date().getTime();
            var ipAddress = localStorage.getItem('ipAddress'); // 修正了键名
            if (!ipAddress) {
                // 如果IP地址未获取到，则不允许评论
                return false;
            }
            if (lastCommentTime && (currentTime - lastCommentTime) < oneHourInMilliseconds) {
                document.getElementById('comment-limit-message').textContent = '每小时只能评论一次，请一小时后再试。';
                return false;
            }
            // 允许评论并更新最后评论时间
            localStorage.setItem('commentLastTime', currentTime); // 修正了键名
            return true;
        }

        // 处理评论提交
        document.getElementById('comment-form').addEventListener('submit', function(event) {
            event.preventDefault();
            if (canComment()) {
                var comment = document.getElementById('comment').value;
                var ipAddress = localStorage.getItem('ipAddress'); // 修正了键名
                var commentElement = document.createElement('div');
                commentElement.innerHTML = '<strong>IP地址为 ' + ipAddress + ' 的用户</strong><br><strong>评论：</strong>' + comment;
                document.getElementById('comment-section').appendChild(commentElement);
                document.getElementById('comment').value = '';
                // 清空评论限制信息
                document.getElementById('comment-limit-message').textContent = '';
            }
        });
    </script>
</body>
</html>